<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  	<title>Login-Unplanned Pregnancy</title>
  	<!--Bootstrap CDN (Content Delivery Network)-->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  	<!--Link for JQuery and JavaScript stuff-->
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  	<script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
  	<link href="style.css" rel="stylesheet">

    <style type="text/css">
      body{
        background-image: url(img/pexels-photo-567973.jpeg);
        background-size: cover;
      }
      .btn {
        //Move to center???
      }
    </style>
  </head>

  <body>
    <div class="regBox">
      <img src="img/user.png" class="loginAvatar">
      <h2>Sign Up</h2>
      <form action="Register.html" method="POST">
        <div class="inputBox">	<!-- input boxes -->
          <p>Username</p>
          <input type="text" name="screen" placeholder="Enter screen name" required="">
          <p>Name</p>
          <input type="text" name="firstName" placeholder="Enter First Name"><br>
          <input type="text" name="lastName" placeholder="Enter Last Name">
          <p>Email</p>
          <input type="text" name="email" placeholder="Enter Email Address" required="">
          <p>Contact</p>
          <input type="text" name="phoneNo" placeholder="Enter Phone Number">
          <p>Date of Birth</p> <!--Replace with calendar-->
          <input type="text" name="dob" placeholder="DD/MM/YYYY">
        </div>

        <div class="inputBox">
        	<p>Gender</p>
        	<input type="radio" name="gender" value="Female">Female&nbsp;&nbsp;&nbsp;
        	<input type="radio" name="gender" value="Male">Male
        </div>

        <div class="inputBox">
          <p>Password</p>
          <input type="password" name="password" placeholder="Enter Password" required="">
          <input type="password" name="verifyPassword" placeholder="Re-enter Password" required="">
        </div>
        <a href="HomePageLoggedIn.html">
          <button type="button" class="btn btn-primary btn-lg">Sign Up</button>
        </a>
        <a href="index.html">
          <button type="button" class="btn btn-outline-light btn-lg">Cancel</button>
        </a>
        <br>
 		<input type="checkbox" name="terms" value="agree">Agree to Ts&Cs
      </form>
    </div>
  </body>
</html>

<?php

	<!--check if user clicked sign up button-->
	if (isset($_POST['submit'])) {

		include_once 'dbh.inc.php';	<!--db access page-->

		$screen_name = mysqli_real_escape_string($conn, $_POST['screen']); <!--prevent users from submitting code-->
		$first = mysqli_real_escape_string($conn, $_POST['firstName']);
		$last = mysqli_real_escape_string($conn, $_POST['lastName']);
		$email = mysqli_real_escape_string($conn, $_POST['email']);
		$phone = mysqli_real_escape_string($conn, $_POST['phoneNo']);
		$dob = mysqli_real_escape_string($conn, $_POST['dob']);
		$gender = mysqli_real_escape_string($conn, $_POST['gender']);
		$password = mysqli_real_escape_string($conn, $_POST['password']);

		<!--error handlers-->
		<!--check for empty fields-->
		if(empty($screen_name) || empty($first) || empty($last) || empty($email) || empty($phone) || empty($dob) || empty($gender) || empty($password)) {
			header("Location: ../Register.html?signup=empty");
			exit();
		}
		else { <!--no empty fields-->
			<!--check if inout characters are valid-->
			if (!preg_match("/^[a-zA-Z]*$/", $screen_name) || !preg_match("/^[a-zA-Z]*$/", $first) || !preg_match("/^[a-zA-Z]*$/", $last) || !preg_match("/^[a-zA-Z]*$/", $phone) || !preg_match("/^[a-zA-Z]*$/", $dob)) {
				header("Location: ../Register.html?signup=invalid");
				exit();
			}
			else { <!--valid charcters-->
				<!--check if email is valid-->
				if(!filter_var($email, FILTER_VALIDATE_EMAIL)) { <!--check if not valid-->
					header("Location: ../Register.html?signup=email");
					exit();
				}
				else {
					<!--check if user name exists-->
					$sql = <!--craig call stored procedure here to check if user name already exists
								"SELECT * FROM users WHERE userId='$screen_name'";-->;
					$result = mysqli_query($conn, $sql);
					$resultCheck = mysqli_num_rows($result);

					if($resultCheck > 0) { <!--screen name already taken-->
						header("Location: ../Register.html?signup=nametaken");
						exit();
					}
					else {
						<!--Hasing password-->
						$hashedPassword = password_hash($password, PASSWORD_DEFAULT);
						<!--insert user into db-->
						$sql = <!--craig, stored procedure to insert user into db
									"INSERT INTO users (.....) VALUES ('$screen_name', '$first'......);"-->;
						mysqli_query($conn, $sql);
						<!--send user to new page-->
						header("Location: ../HomePageLoggedIn.html?signup=success");
						exit();
					}
				}
			}
		}
	}
	else {
		<!--send back to sign up page-->
		header("Location: ../Register.html");
		exit();
	}

?>
